##################################################################################################################################
# To run this analysis, prepare the following input data
# <range>  a text, Excel, or R file in BED format, specify the read subsets mapped to the given regions 
#  - no column and row names
#  - the first 3 columns are chromosome name, start position, and end position 
#  - chromosome names must match chromosome names of the reference the reads were mapped to
# <sample> named list of source files where the mapped reads were saved 
#  - If reads have not been imported into R, the files must be indexed BAM files, with a pairing .bai file
#     - For each sample, specify the path to an indexed BAM file. Could be an URL
#     - Pair the BAM file with its .bai file. If not given, it's assumed that the file is <filename.bam>.bai
#  - If reads have been imported, the files must be .rds or .rdata files
#     - Loaded reads are stored as GAlignments or GAlignmentPairs object, use the readGAlignments or readGAlignmentPairs function
#     - Two extra SAM fields, flag and mapq, must be loaded with each read, for example:
#       * readGAlignments(bamfile, baifile, param=ScanBamParam(which=range, what=c('flag', 'mapq')))
#       * readGAlignmentPairs(bamfile, baifile, param=ScanBamParam(which=range, what=c('flag', 'mapq')))
##################################################################################################################################

####################
##### REQUIRED #####
####################
# Required fields for generating any report using the RoCA::CreateReport() function
template: https://raw.githubusercontent.com/zhezhangsh/RoCA/master/template/qc/filter_read/filter_read.Rmd 
#template: filter_read.Rmd 
output: examples/1000genome                                                            # Where to write all the output files
home: http://1000genomes.org                                                           # URL or path to the project home page. Leave it empty if the page doesn't exist.
analyst: Zhe Zhang                                                                     # Name of the analyst
zip: no                                                                                # Whether to zip all output files

#################
##### ABOUT #####
#################
# Description of this analysis, could be any name/text pairs
description:
  Project: 1000 Genomes Project
  Experiment: The goal of the 1000 Genomes Project was to find most genetic variants with frequencies of at least 1% in the populations studied.
  Analysis: This is a testing of retrieving, summarizing, and filtering sequencing reads mapped to a few small genomic regions from a small number of 1000 Genomes samples.

######################
##### INPUT DATA #####
######################
# Prepared input data, saved in .rds format using the saveRDS() function
input:  # Location of input files
  range: https://raw.githubusercontent.com/zhezhangsh/RoCA/master/data/genomic.region/small_region.bed # GRanges object, usually chromosomes of a species, reads out of the range will be removed
  sample:         # Sequence reads saved as Galignments objects, SAM fields, flag, mapq, and cigar, are also saved 
    NA21130:      # Sample name to be used in the report
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21130/alignment/NA21130.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21130/alignment/NA21130.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam.bai # Could be a local file if already downloaded
    NA21133:
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21133/alignment/NA21133.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21133/alignment/NA21133.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam.bai
    NA21135:
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21135/alignment/NA21135.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21135/alignment/NA21135.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam.bai
    NA21141:
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21141/alignment/NA21141.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21141/alignment/NA21141.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam.bai
    NA21142:
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21142/alignment/NA21142.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21142/alignment/NA21142.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam.bai
    NA21143:
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21143/alignment/NA21143.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21143/alignment/NA21143.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam.bai
    NA21144:
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21144/alignment/NA21144.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam
    - ftp://ftp-trace.ncbi.nih.gov/1000genomes/ftp/phase3/data/NA21144/alignment/NA21144.mapped.ILLUMINA.bwa.GIH.low_coverage.20130415.bam.bai

######################
##### PARAMETERS #####
######################
# Parameters to run this analysis
parameter:
  loaded: no    # Whether the BAM file has been loaded into R as GAlignments or GAlignmentPairs object
  paired: yes   # Whether to load reads from BAM as pair-ended or single-ended. Ignored if the reads were already loaded
  cleanup: yes  # Whether to clean up temparory files downloaded to the input/ subfolder, such as .bai files
  flag:         # Filtering rule: values of the SAM field FLAG must be one of given values; no filtering if -1
  - 83 
  - 99
  mapq:         # Filtering rule: the minimal value of the SAM field MAPQ; no filtering if less than 1
    max: 20       # The maximum score of the 2 reads for pair-ended reads. 
    total: 30     # The total score of the 2 reads for pair-ended reads. 
                  # For single-ended reads, both max and total cutoffs apply to each single read, and should have the same value
  match:        # Filtering rule: the minimal value of matching length based on the SAM field CIGAR; no filtering if less than 1
    max: 33       # The maximum matching length of the 2 reads for pair-ended reads. 
    total: 133    # The total matching length of the 2 reads for pair-ended reads. 
                  # For single-ended reads, both max and total cutoffs apply to each single read, and should have the same value
  cigar:        # Type of CIGAR operators to summarize
  - M
  - S
  - D
  - I


