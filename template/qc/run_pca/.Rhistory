if (dev.cur()!=1) dev.off();
fn;
});
fns <- paste('figure', TrimPath(fns), sep='/');
lns <- paste(paste('###', colnames(smp)), '\n\n', paste('![](', fns, ')', sep=''), '\n\n', collapse='');
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else
col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]);
names(col) <- unique(smp[, nm]);
col <- col[as.character(smp[, nm])];
if (identical('ID', nm)) lbl <- 1:nrow(smp) else lbl <- smp[, nm];
PlotPCA(pca, groups=smp[, nm], new.window = FALSE, cex=cex, col=col, label=lbl, legend=TRUE,
legend.single = identical('ID', nm), dimensions = c(plt$dimension[1], plt$dimension[2]));
if (dev.cur()!=1) dev.off();
fn;
col
length(unique(col))
table(col)
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else
col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]);
cnm
col
length(unique(col))
length(unique(smp[, nm]))
col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]);
col
length(unique(col))
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else
col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]);
names(col) <- unique(smp[, nm]);
col <- col[as.character(smp[, nm])];
if (identical('ID', nm)) lbl <- 1:nrow(smp) else lbl <- smp[, nm];
col
dev.off
dev.off()
.
if (dev.cur()!=1) dev.off();
if (dev.cur()!=1) dev.off();
col
length(col)
length(unique(col))
col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]);
col
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
col
x <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]);
x
length(unique(x))
col
table(col)
length(unique(x))
x
y <- table(x)
table(y)
y <- y[y==2]
y
which(x==names(y))
args(colorpanel)
?colorpanel
colorpanel(4, 'green', 'red')
colorpanel(4, 'green', 'blue', 'red')
smp <- smpl[, !(colnames(smpl) %in% prms$exclude), drop=FALSE];
smp <- cbind(ID=rownames(smp), smp);
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
shp <- tolower(prms$plot$shape[1]);
pch <- 19;
smp <- smpl[, !(colnames(smpl) %in% prms$exclude), drop=FALSE];
smp <- cbind(ID=rownames(smp), smp);
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
shp <- tolower(prms$plot$shape[1]);
pch <- 19;
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- unique(smp[, nm]);
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
ncl
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- length(unique(smp[, nm]));
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
names(col) <- unique(smp[, nm]);
col
smp <- smpl[, !(colnames(smpl) %in% prms$exclude), drop=FALSE];
smp <- cbind(ID=rownames(smp), smp);
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
shp <- tolower(prms$plot$shape[1]);
pch <- 19;
if (shp=='square') pch <- 15 else if (shp=='triangle') pch <- 17 else if (shp=='diamond') pch <- 18;
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- length(unique(smp[, nm]));
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
col
ncl
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- length(unique(smp[, nm]));
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
col <- colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
names(col) <- unique(smp[, nm]);
col
length(col)
length(unique(col))
smp <- smpl[, !(colnames(smpl) %in% prms$exclude), drop=FALSE];
smp <- cbind(ID=rownames(smp), smp);
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
shp <- tolower(prms$plot$shape[1]);
pch <- 19;
if (shp=='square') pch <- 15 else if (shp=='triangle') pch <- 17 else if (shp=='diamond') pch <- 18;
fns <- sapply(colnames(smp), function(nm) {
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- length(unique(smp[, nm]));
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
col <- colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
names(col) <- unique(smp[, nm]);
col <- col[as.character(smp[, nm])];
if (identical('ID', nm)) lbl <- 1:nrow(smp) else lbl <- smp[, nm];
PlotPCA(pca, groups=smp[, nm], new.window = FALSE, cex=cex, col=col, label=lbl, legend=TRUE,
legend.single = identical('ID', nm), dimensions = c(plt$dimension[1], plt$dimension[2]));
if (dev.cur()!=1) dev.off();
fn;
});
fns <- paste('figure', TrimPath(fns), sep='/');
lns <- paste(paste('###', colnames(smp)), '\n\n', paste('![](', fns, ')', sep=''), '\n\n', collapse='');
smp <- smpl[, !(colnames(smpl) %in% prms$exclude), drop=FALSE];
smp <- cbind(ID=rownames(smp), smp);
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
shp <- tolower(prms$plot$shape[1]);
pch <- 19;
if (shp=='square') pch <- 15 else if (shp=='triangle') pch <- 17 else if (shp=='diamond') pch <- 18;
fns <- sapply(colnames(smp), function(nm) {
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- length(unique(smp[, nm]));
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
col <- colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
names(col) <- unique(smp[, nm]);
col <- col[as.character(smp[, nm])];
if (identical('ID', nm)) lbl <- 1:nrow(smp) else lbl <- as.integer(as.factor(smp[, nm]));
PlotPCA(pca, groups=smp[, nm], new.window = FALSE, cex=cex, col=col, label=lbl, legend=TRUE,
legend.single = identical('ID', nm), dimensions = c(plt$dimension[1], plt$dimension[2]));
if (dev.cur()!=1) dev.off();
fn;
});
fns <- paste('figure', TrimPath(fns), sep='/');
lns <- paste(paste('###', colnames(smp)), '\n\n', paste('![](', fns, ')', sep=''), '\n\n', collapse='');
smp <- smpl[, !(colnames(smpl) %in% prms$exclude), drop=FALSE];
smp <- cbind(ID=rownames(smp), smp);
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
shp <- tolower(prms$plot$shape[1]);
pch <- 19;
if (shp=='square') pch <- 15 else if (shp=='triangle') pch <- 17 else if (shp=='diamond') pch <- 18;
fns <- sapply(colnames(smp), function(nm) {
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- length(unique(smp[, nm]));
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
col <- colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
names(col) <- unique(smp[, nm]);
col <- col[as.character(smp[, nm])];
if (identical('ID', nm)) lbl <- 1:nrow(smp) else lbl <- as.integer(as.factor(smp[, nm]));
PlotPCA(pca, groups=smp[, nm], new.window = FALSE, cex=cex, col=col, label=lbl, legend=TRUE,
legend.single = TRUE, dimensions = c(plt$dimension[1], plt$dimension[2]));
if (dev.cur()!=1) dev.off();
fn;
});
fns <- paste('figure', TrimPath(fns), sep='/');
lns <- paste(paste('###', colnames(smp)), '\n\n', paste('![](', fns, ')', sep=''), '\n\n', collapse='');
smp <- smpl[, !(colnames(smpl) %in% prms$exclude), drop=FALSE];
smp <- cbind(ID=rownames(smp), smp);
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
shp <- tolower(prms$plot$shape[1]);
pch <- 19;
if (shp=='square') pch <- 15 else if (shp=='triangle') pch <- 17 else if (shp=='diamond') pch <- 18;
fns <- sapply(colnames(smp), function(nm) {
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- length(unique(smp[, nm]));
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
col <- colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
names(col) <- unique(smp[, nm]);
col <- col[as.character(smp[, nm])];
if (identical('ID', nm)) lbl <- 1:nrow(smp) else lbl <- as.integer(as.factor(smp[, nm]));
PlotPCA(pca, groups=smp[, nm], new.window = FALSE, cex=cex, col=col, label=lbl, legend=TRUE,
legend.single = identical('ID', nm), dimensions = c(plt$dimension[1], plt$dimension[2]));
if (dev.cur()!=1) dev.off();
fn;
});
fns <- paste('figure', TrimPath(fns), sep='/');
lns <- paste(paste('###', colnames(smp)), '\n\n', paste('![](', fns, ')', sep=''), '\n\n', collapse='');
smp <- smpl[, !(colnames(smpl) %in% prms$exclude), drop=FALSE];
smp <- cbind(ID=rownames(smp), smp);
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
shp <- tolower(prms$plot$shape[1]);
pch <- 19;
if (shp=='square') pch <- 15 else if (shp=='triangle') pch <- 17 else if (shp=='diamond') pch <- 18;
fns <- sapply(colnames(smp), function(nm) {
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- length(unique(smp[, nm]));
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
col <- colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
names(col) <- unique(smp[, nm]);
col <- col[as.character(smp[, nm])];
if (identical('ID', nm)) {
lbl <- 1:nrow(smp);
grp <- smp[, nm];
} else {
lbl <- as.integer(as.factor(smp[, nm]));
grp <- paste(lbl, smp[, nm], sep=':');
}
PlotPCA(pca, groups=smp[, nm], new.window = FALSE, cex=cex, col=col, label=lbl, legend=TRUE,
legend.single = identical('ID', nm), dimensions = c(plt$dimension[1], plt$dimension[2]));
if (dev.cur()!=1) dev.off();
fn;
});
fns <- paste('figure', TrimPath(fns), sep='/');
lns <- paste(paste('###', colnames(smp)), '\n\n', paste('![](', fns, ')', sep=''), '\n\n', collapse='');
smp <- smpl[, !(colnames(smpl) %in% prms$exclude), drop=FALSE];
smp <- cbind(ID=rownames(smp), smp);
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
shp <- tolower(prms$plot$shape[1]);
pch <- 19;
if (shp=='square') pch <- 15 else if (shp=='triangle') pch <- 17 else if (shp=='diamond') pch <- 18;
fns <- sapply(colnames(smp), function(nm) {
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- length(unique(smp[, nm]));
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
col <- colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
names(col) <- unique(smp[, nm]);
col <- col[as.character(smp[, nm])];
if (identical('ID', nm)) {
lbl <- 1:nrow(smp);
grp <- smp[, nm];
} else {
lbl <- as.integer(as.factor(smp[, nm]));
grp <- paste(lbl, smp[, nm], sep=':');
}
PlotPCA(pca, groups=grp, new.window = FALSE, cex=cex, col=col, label=lbl, legend=TRUE,
legend.single = identical('ID', nm), dimensions = c(plt$dimension[1], plt$dimension[2]));
if (dev.cur()!=1) dev.off();
fn;
});
fns <- paste('figure', TrimPath(fns), sep='/');
lns <- paste(paste('###', colnames(smp)), '\n\n', paste('![](', fns, ')', sep=''), '\n\n', collapse='');
smp <- smpl[, !(colnames(smpl) %in% prms$exclude), drop=FALSE];
smp <- cbind(ID=rownames(smp), smp);
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
shp <- tolower(prms$plot$shape[1]);
pch <- 19;
if (shp=='square') pch <- 15 else if (shp=='triangle') pch <- 17 else if (shp=='diamond') pch <- 18;
fns <- sapply(colnames(smp), function(nm) {
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- length(unique(smp[, nm]));
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
col <- colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
names(col) <- unique(smp[, nm]);
col <- col[as.character(smp[, nm])];
if (identical('ID', nm)) {
lbl <- 1:nrow(smp);
grp <- smp[, nm];
} else {
lbl <- as.integer(as.factor(smp[, nm]));
grp <- paste(lbl, smp[, nm], sep='-');
}
PlotPCA(pca, groups=grp, new.window = FALSE, cex=cex, col=col, label=lbl, legend=TRUE,
legend.single = identical('ID', nm), dimensions = c(plt$dimension[1], plt$dimension[2]));
if (dev.cur()!=1) dev.off();
fn;
});
fns <- paste('figure', TrimPath(fns), sep='/');
lns <- paste(paste('###', colnames(smp)), '\n\n', paste('![](', fns, ')', sep=''), '\n\n', collapse='');
smp <- smpl[, !(colnames(smpl) %in% prms$exclude), drop=FALSE];
smp <- cbind(ID=rownames(smp), smp);
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
shp <- tolower(prms$plot$shape[1]);
pch <- 19;
if (shp=='square') pch <- 15 else if (shp=='triangle') pch <- 17 else if (shp=='diamond') pch <- 18;
fns <- sapply(colnames(smp), function(nm) {
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- length(unique(smp[, nm]));
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
col <- colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
names(col) <- unique(smp[, nm]);
col <- col[as.character(smp[, nm])];
if (identical('ID', nm)) {
lbl <- 1:nrow(smp);
grp <- smp[, nm];
} else {
lbl <- as.integer(as.factor(smp[, nm]));
grp <- paste0('[', lbl, ']-', smp[, nm]);
}
PlotPCA(pca, groups=grp, new.window = FALSE, cex=cex, col=col, label=lbl, legend=TRUE,
legend.single = identical('ID', nm), dimensions = c(plt$dimension[1], plt$dimension[2]));
if (dev.cur()!=1) dev.off();
fn;
});
fns <- paste('figure', TrimPath(fns), sep='/');
lns <- paste(paste('###', colnames(smp)), '\n\n', paste('![](', fns, ')', sep=''), '\n\n', collapse='');
smp <- smpl[, !(colnames(smpl) %in% prms$exclude), drop=FALSE];
smp <- cbind(ID=rownames(smp), smp);
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
shp <- tolower(prms$plot$shape[1]);
pch <- 19;
if (shp=='square') pch <- 15 else if (shp=='triangle') pch <- 17 else if (shp=='diamond') pch <- 18;
fns <- sapply(colnames(smp), function(nm) {
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- length(unique(smp[, nm]));
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
col <- colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
names(col) <- unique(smp[, nm]);
col <- col[as.character(smp[, nm])];
if (identical('ID', nm)) {
lbl <- 1:nrow(smp);
grp <- smp[, nm];
} else {
lbl <- as.integer(as.factor(smp[, nm]));
grp <- paste0('[', lbl, ']: ', smp[, nm]);
}
PlotPCA(pca, groups=grp, new.window = FALSE, cex=cex, col=col, label=lbl, legend=TRUE,
legend.single = identical('ID', nm), dimensions = c(plt$dimension[1], plt$dimension[2]));
if (dev.cur()!=1) dev.off();
fn;
});
fns <- paste('figure', TrimPath(fns), sep='/');
lns <- paste(paste('###', colnames(smp)), '\n\n', paste('![](', fns, ')', sep=''), '\n\n', collapse='');
smp <- smpl[, !(colnames(smpl) %in% prms$exclude), drop=FALSE];
smp <- cbind(ID=rownames(smp), smp);
plt <- prms$plot;
col <- plt$color;
col <- lapply(col, function(c) pmax(0, pmin(1, c)));
col <- sapply(1:3, function(i) rgb(col[[1]][i], col[[2]][i], col[[3]][i]));
shp <- tolower(prms$plot$shape[1]);
pch <- 19;
if (shp=='square') pch <- 15 else if (shp=='triangle') pch <- 17 else if (shp=='diamond') pch <- 18;
fns <- sapply(colnames(smp), function(nm) {
fn <- paste(path.fig, paste('pca_', nm, '.png', sep=''), sep='/');
png(fn, w=1000, h=750);
cex <- min(5, max(0.5, 200/nrow(smp)));
cnm <- length(unique(smp[, nm]));
if (cnm==1) col <- col[1] else
if (cnm==2) col<-col[c(1, length(col))] else {
if (length(col)==2) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2]) else {
ncl <- length(unique(smp[, nm]));
if (ncl %% 2 == 1) col <- colorpanel(length(unique(smp[, nm])), col[1], col[2], col[3]) else
col <- colorpanel(length(unique(smp[, nm]))+1, col[1], col[2], col[3])[-round(ncl)];
}
}
names(col) <- unique(smp[, nm]);
col <- col[as.character(smp[, nm])];
if (identical('ID', nm)) {
lbl <- 1:nrow(smp);
grp <- smp[, nm];
} else {
lbl <- as.integer(as.factor(smp[, nm]));
grp <- paste0('[', lbl, '] - ', smp[, nm]);
}
PlotPCA(pca, groups=grp, new.window = FALSE, cex=cex, col=col, label=lbl, legend=TRUE,
legend.single = identical('ID', nm), dimensions = c(plt$dimension[1], plt$dimension[2]));
if (dev.cur()!=1) dev.off();
fn;
});
fns <- paste('figure', TrimPath(fns), sep='/');
lns <- paste(paste('###', colnames(smp)), '\n\n', paste('![](', fns, ')', sep=''), '\n\n', collapse='');
