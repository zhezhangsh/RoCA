<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Jim Zhang" />

<meta name="date" content="2016-12-25" />

<title>tSNE-DBSCAN classification</title>

<script src="index_files/jquery-1.11.3/jquery.min.js"></script>
<script src="index_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="index_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="index_files/tocify-1.9.1/jquery.tocify.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="index_files/highlight/default.css"
      type="text/css" />
<script src="index_files/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
  padding-left: 10px;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">tSNE-DBSCAN classification</h1>
<h4 class="author"><em>Jim Zhang</em></h4>
<h4 class="date"><em>2016-12-25</em></h4>

</div>


<div style="border:black 1px solid; padding: 0.5cm 0.5cm">
<p>This analysis performs sample classification using high-dimension data. It includes two main steps:</p>
<p><strong>The first step</strong> uses the <strong>t-SNE</strong> (t-Distributed Stochastic Neighbor Embedding) to create a 2D or 3D-map from high dimensional data. The Barnes-Hut version of t-SNE is used to reduce computing time, so it can be run for multiple times. The result of t-SNE run having the lowest Kullback–Leibler (KL) divergence will be used for the next step.</p>
<p><strong>The second step</strong> uses the <strong>DBSCAN</strong> method to cluster samples using the t-SNE result from the last step. The two key parameters of DBSCAN, <em>epsilon neighborhood</em> and <em>minimum cluster size</em> are adjusted based on silhouette score to obtain optimal classification.</p>
<p>Additionally, the result of unsupervised clustering is compared to any known sample features to evaluate their association.</p>
</div>
<p> </p>
<div align="right">
<em><a href="https://github.com/zhezhangsh/RoCA">Go to project home</a></em>
</div>
<div id="description" class="section level1">
<h1><span class="header-section-number">1</span> Description</h1>
<div id="project" class="section level2">
<h2><span class="header-section-number">1.1</span> Project</h2>
<p>Classification of immune cells</p>
</div>
<div id="analysis" class="section level2">
<h2><span class="header-section-number">1.2</span> Analysis</h2>
<p>This analysis uses transcriptome data to classify samples from different immune cells and disease states.</p>
</div>
<div id="samples" class="section level2">
<h2><span class="header-section-number">1.3</span> Samples</h2>
<p>3 immune cell types (B, T, and monocyte) from 6 donors, including 3 healthy controls and 3 patients.</p>
<div align="right">
<em><a href="https://github.com/zhezhangsh/RoCA">Go to project home</a></em>
</div>
<div align="right">
<em><a href="https://github.com/zhezhangsh/RoCA">Go to project home</a></em>
</div>
</div>
</div>
<div id="results" class="section level1">
<h1><span class="header-section-number">2</span> Results</h1>
<div id="t-sne" class="section level2">
<h2><span class="header-section-number">2.1</span> t-SNE</h2>
<p><strong>t-SNE</strong> (t-Distributed Stochas- tic Neighbor Embedding) is a method of feature reduction that maps high-dimentional data to a 2- or 3-dimensional space. This analysis utilizes the Barnes-Hut version on a data matrix with <strong>18</strong> samples and <strong>25207</strong> features. The method is implemented by the <em>Rtsne {Rtsne}</em> R function.</p>
<p>On a t-SNE space, the similarities between samples is measured by their overall KL (Kullback–Leibler) divergence. An optimal t-SNE run should have relatively lower KL divergence. Each t-SNE run of this analysis involves the following sub-steps:</p>
<ul>
<li>Run an initial PCA to reduce the number of features to <strong>50</strong>;</li>
<li>Calculate the euclidean distance between any two samples to get a similarity score;</li>
<li>The distance of each sample to <strong>2</strong> nearest neighbors is fit to a <em>Cauchy</em> distribution, on a <strong>2</strong>-dimensional space;</li>
<li>The <em>Barnes-Hut</em> approximation is used to reduce computational complexity, with <strong>theta = 0.5</strong>;</li>
<li>The position of samples on the low dimensional space is adjusted for up to <strong>1000</strong> iterations to lower overall KL divergence.</li>
</ul>
<p>The steps above are re-run for <strong>5</strong> times, and output from the run with the lowest KL divergence is the final result of t-SNE.</p>
<div align="center">
<pre><code>## Error in switch(options$dev, pdf = &quot;.pdf&quot;, jpeg = &quot;.jpeg&quot;, &quot;.png&quot;): EXPR must be a length 1 vector</code></pre>
</div>
<div style="color:darkblue; padding:0 3cm">
<strong>Figure 1.</strong> The t-SNE program is run repeatedly for 5 times, and the final <em>Kullback-Leibler</em> divergence, or total cost, of the map generated by all runs is summarized in this figure. Click <a href="table/kl_divergence.txt">here</a> to download the full table of KL divergence.
</div>
<div align="center">
<pre><code>## Error in switch(options$dev, pdf = &quot;.pdf&quot;, jpeg = &quot;.jpeg&quot;, &quot;.png&quot;): EXPR must be a length 1 vector</code></pre>
<pre><code>## Error in switch(options$dev, pdf = &quot;.pdf&quot;, jpeg = &quot;.jpeg&quot;, &quot;.png&quot;): EXPR must be a length 1 vector</code></pre>
</div>
<div style="color:darkblue; padding:0 3cm">
<strong>Figure 2.</strong> t-SNE runs with the highest and the lowest KL divergence. The run with the lowest KL divergence is picked as the final t-SNE results and input to DBSCAN classification.
</div>
<div align="right">
<em><a href="https://github.com/zhezhangsh/RoCA">Go to project home</a></em>
</div>
</div>
<div id="dbscan" class="section level2">
<h2><span class="header-section-number">2.2</span> DBSCAN</h2>
<p><strong>DBSCAN</strong> (Density-based spatial clustering of applications with noise) is a sample clustering method based on the density of sample on a multi-dimensional space. This analysis uses the <em>dbscan {dbscan}</em> R implementation of this method. Its input is the result of t-SNE run with the lowest KL divergence and its output is evaluated by the silhouette score of clustered samples. Each DBSCAN run requires the following parameters:</p>
<ul>
<li><strong>eps</strong> (required): size of the epsilon neighborhood. This analysis uses a iterative procedure to identify the <strong>eps</strong> value maximizing the silhouette score of clustered samples.</li>
<li><strong>minPts</strong> (required): minimal number of core points (samples) to form a cluster. This analysis tests the <strong>minPts</strong> value from <strong>2</strong> to <strong>9</strong> to identify the optimal <strong>eps/minPts</strong> combination with the highest silhouette score.</li>
<li><strong>search</strong>: nearest neighbor search strategy = “<strong>kdtree</strong>”.</li>
<li><strong>bucketSize</strong>: max size of the kd-tree leafs = <strong>10</strong>.</li>
<li><strong>splitRule</strong> rule to split the kd-tree = “<strong>suggest</strong>”.</li>
<li><strong>approx</strong>: relative error bound for approximate nearest neighbor searching = <strong>0</strong>.</li>
</ul>
<div align="center">
<pre><code>## Error in switch(options$dev, pdf = &quot;.pdf&quot;, jpeg = &quot;.jpeg&quot;, &quot;.png&quot;): EXPR must be a length 1 vector</code></pre>
</div>
<div style="color:darkblue; padding:0 3cm">
<strong>Figure 3.</strong> The average of silhouette scores corresponding to each value of minimal cluster size. The minimal cluster size having the highest score is highlighted in red.
</div>
<p>The optimal value of <strong>minPts</strong> (minimal number of samples in a cluster) is <strong>2</strong>. The corresponding clustering result of DBSCAN will be used for the rest of this analysis.</p>
<div style="color:darkblue; padding:0 1cm">
<strong>Table 1</strong> Summarization of clusters identified by DBSCAN using t-SNE output. Click <a href="table/dbscan_classification.txt">here</a> to download the full table of classification results.
</div>
<div align="center" ,="" style="padding:0 1cm">
<table>
<thead>
<tr class="header">
<th align="right">Cluster_ID</th>
<th align="right">N</th>
<th align="right">Neighbors</th>
<th align="right">Width_Mean</th>
<th align="right">Width_Median</th>
<th align="right">Width_Min</th>
<th align="right">Width_1stQu</th>
<th align="right">Width_3rdQu</th>
<th align="right">Width_Max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">Cluster_0</td>
<td align="right">0</td>
<td align="right"></td>
<td align="right">NaN</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">Cluster_1</td>
<td align="right">3</td>
<td align="right">2;4</td>
<td align="right">0.85</td>
<td align="right">0.85</td>
<td align="right">0.810</td>
<td align="right">0.83</td>
<td align="right">0.87</td>
<td align="right">0.89</td>
</tr>
<tr class="odd">
<td align="right">Cluster_2</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">0.88</td>
<td align="right">0.87</td>
<td align="right">0.870</td>
<td align="right">0.87</td>
<td align="right">0.88</td>
<td align="right">0.90</td>
</tr>
<tr class="even">
<td align="right">Cluster_3</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">0.52</td>
<td align="right">0.64</td>
<td align="right">0.096</td>
<td align="right">0.50</td>
<td align="right">0.66</td>
<td align="right">0.70</td>
</tr>
<tr class="odd">
<td align="right">Cluster_4</td>
<td align="right">3</td>
<td align="right">6</td>
<td align="right">0.80</td>
<td align="right">0.81</td>
<td align="right">0.770</td>
<td align="right">0.79</td>
<td align="right">0.82</td>
<td align="right">0.83</td>
</tr>
<tr class="even">
<td align="right">Cluster_5</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">0.92</td>
<td align="right">0.92</td>
<td align="right">0.900</td>
<td align="right">0.91</td>
<td align="right">0.92</td>
<td align="right">0.93</td>
</tr>
<tr class="odd">
<td align="right">Cluster_6</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0.81</td>
<td align="right">0.81</td>
<td align="right">0.790</td>
<td align="right">0.80</td>
<td align="right">0.82</td>
<td align="right">0.83</td>
</tr>
</tbody>
</table>
</div>
<div align="center">
<pre><code>## Error in switch(options$dev, pdf = &quot;.pdf&quot;, jpeg = &quot;.jpeg&quot;, &quot;.png&quot;): EXPR must be a length 1 vector</code></pre>
</div>
<div style="color:darkblue; padding:0 3cm">
<strong>Figure 4.</strong> Samples are clustered via DBSCAN using the results from t-SNE run with the lowest KL divergence. Samples in the same clusters have the same colors. <strong>Cluster_0</strong> is made of samples cannot be clustered.
</div>
<div align="right">
<em><a href="https://github.com/zhezhangsh/RoCA">Go to project home</a></em>
</div>
</div>
<div id="cluster-feature-association" class="section level2">
<h2><span class="header-section-number">2.3</span> Cluster-feature association</h2>
<p>If the samples have been previously labeled with their known features, such as genotype, treatment and disease state, the agreement between these features and DBSCAN classification can be evaluated to discover potential feature-classification association.</p>
<div style="color:darkblue; padding:0 0.5cm">
<p><strong>Table 2</strong> Summary of cluster-feature association.</p>
<ul>
<li><em>Num_Group</em>: Number of sample groups according to the feature;</li>
<li><em>Rand</em>: Rand index; <em>C_Rand</em>: corrected RAND index;</li>
<li><em>ChiSq</em>: Chi-squared test statistics;</li>
<li><em>P_ChiSq</em>: p value of Chi-square test;</li>
<li><em>Count_Expected</em>: table with expected counts within each cell of the contingency table;</li>
<li><em>Count_Observed</em>: table with observed counts within each cell of the contingency table;</li>
<li><em>Obs/Exp</em>: table with expected vs. observed counts.</li>
</ul>
</div>
<div align="center" ,="" style="padding:0 0.5cm">
<table>
<thead>
<tr class="header">
<th align="left">Feature</th>
<th align="right">Num_Group</th>
<th align="right">Rand</th>
<th align="right">C_Rand</th>
<th align="right">ChiSq</th>
<th align="right">P_ChiSq</th>
<th align="right">Count_Expected</th>
<th align="right">Count_Observed</th>
<th align="right">Obs/Exp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Group</td>
<td align="right">6</td>
<td align="right">0.97</td>
<td align="right">0.85</td>
<td align="right">81</td>
<td align="right">0.0001</td>
<td align="right"><a href="table/expected_cluster2Group.html">Table</a></td>
<td align="right"><a href="table/observed_cluster2Group.html">Table</a></td>
<td align="right"><a href="table/ratio_cluster2Group.html">Table</a></td>
</tr>
<tr class="even">
<td align="left">Cell</td>
<td align="right">3</td>
<td align="right">0.83</td>
<td align="right">0.51</td>
<td align="right">36</td>
<td align="right">0.0001</td>
<td align="right"><a href="table/expected_cluster2Cell.html">Table</a></td>
<td align="right"><a href="table/observed_cluster2Cell.html">Table</a></td>
<td align="right"><a href="table/ratio_cluster2Cell.html">Table</a></td>
</tr>
<tr class="odd">
<td align="left">Disease</td>
<td align="right">2</td>
<td align="right">0.61</td>
<td align="right">0.19</td>
<td align="right">15</td>
<td align="right">0.0027</td>
<td align="right"><a href="table/expected_cluster2Disease.html">Table</a></td>
<td align="right"><a href="table/observed_cluster2Disease.html">Table</a></td>
<td align="right"><a href="table/ratio_cluster2Disease.html">Table</a></td>
</tr>
<tr class="even">
<td align="left">Donor</td>
<td align="right">6</td>
<td align="right">0.76</td>
<td align="right">-0.14</td>
<td align="right">18</td>
<td align="right">1.0000</td>
<td align="right"><a href="table/expected_cluster2Donor.html">Table</a></td>
<td align="right"><a href="table/observed_cluster2Donor.html">Table</a></td>
<td align="right"><a href="table/ratio_cluster2Donor.html">Table</a></td>
</tr>
</tbody>
</table>
</div>
<div align="center">
<pre><code>## Error in switch(options$dev, pdf = &quot;.pdf&quot;, jpeg = &quot;.jpeg&quot;, &quot;.png&quot;): EXPR must be a length 1 vector</code></pre>
</div>
<div style="color:darkblue; padding:0 3cm">
<strong>Figure 5.</strong> The contingency table of the clusters and the known sample feature has the most significant association based on Chi-square test. The numbers are the counts of samples at each intersect. The colors indicate the ratios of observed over expected sample counts.
</div>
<div align="right">
<em><a href="https://github.com/zhezhangsh/RoCA">Go to project home</a></em>
</div>
<hr />
<!-- Keep this section unchanged for all RoCA templates -->
</div>
</div>
<div id="appendix" class="section level1">
<h1><span class="header-section-number">3</span> Appendix</h1>
<p>Check out the <strong><a href="http://zhezhangsh.github.io/RoCA">RoCA home page</a></strong> for more information.</p>
<div id="reproduce-this-report" class="section level2">
<h2><span class="header-section-number">3.1</span> Reproduce this report</h2>
<p>To reproduce this report:</p>
<ol style="list-style-type: decimal">
<li><p>Find the data analysis template you want to use and an example of its pairing YAML file <a href="https://github.com/zhezhangsh/RoCA/wiki/Templates-and-examples">here</a> and download the YAML example to your working directory</p></li>
<li><p>To generate a new report using your own input data and parameter, edit the following items in the YAML file:</p>
<ul>
<li><em>output</em> : where you want to put the output files</li>
<li><em>home</em> : the URL if you have a home page for your project</li>
<li><em>analyst</em> : your name</li>
<li><em>description</em> : background information about your project, analysis, etc.</li>
<li><em>input</em> : where are your input data, read instruction for preparing them</li>
<li><em>parameter</em> : parameters for this analysis; read instruction about how to prepare input data</li>
</ul></li>
<li><p>Run the code below within <strong><em>R Console</em></strong> or <strong><em>RStudio</em></strong>, preferablly with a new R session:</p></li>
</ol>
<pre class="r"><code>if (!require(devtools)) { install.packages(&#39;devtools&#39;); require(devtools); }
if (!require(RCurl)) { install.packages(&#39;RCurl&#39;); require(RCurl); }
if (!require(RoCA)) { install_github(&#39;zhezhangsh/RoCAR&#39;); require(RoCA); }

CreateReport(filename.yaml);  # filename.yaml is the YAML file you just downloaded and edited</code></pre>
<p>If there is no complaint, go to the <em>output</em> folder and open the <strong><em>index.html</em></strong> file to view report.</p>
</div>
<div id="session-information" class="section level2">
<h2><span class="header-section-number">3.2</span> Session information</h2>
<pre><code>## R version 3.2.2 (2015-08-14)
## Platform: x86_64-apple-darwin13.4.0 (64-bit)
## Running under: OS X 10.10.5 (Yosemite)
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats4    grid      stats     graphics  grDevices utils     datasets 
## [8] methods   base     
## 
## other attached packages:
##  [1] flexclust_1.3-4     modeltools_0.2-21   lattice_0.20-33    
##  [4] cluster_2.0.4       e1071_1.6-7         gplots_3.0.1       
##  [7] dbscan_0.9-8        Rtsne_0.11          plotly_4.5.2       
## [10] ggplot2_2.1.0       htmlwidgets_0.7     DT_0.2             
## [13] awsomics_0.0.0.9000 yaml_2.1.13         rmarkdown_1.0      
## [16] knitr_1.14          RoCA_0.0.0.9000     RCurl_1.95-4.8     
## [19] bitops_1.0-6        devtools_1.12.0    
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.6        highr_0.6          formatR_1.4       
##  [4] plyr_1.8.4         class_7.3-14       base64enc_0.1-3   
##  [7] tools_3.2.2        digest_0.6.10      jsonlite_1.0      
## [10] evaluate_0.9       memoise_1.0.0      tibble_1.1        
## [13] gtable_0.2.0       viridisLite_0.1.3  DBI_0.4-1         
## [16] parallel_3.2.2     withr_1.0.2        stringr_1.0.0     
## [19] dplyr_0.5.0        httr_1.2.1         caTools_1.17.1    
## [22] gtools_3.5.0       R6_2.1.2           gdata_2.17.0      
## [25] purrr_0.2.2        tidyr_0.5.1        magrittr_1.5      
## [28] scales_0.4.0       htmltools_0.3.5    assertthat_0.1    
## [31] colorspace_1.2-6   KernSmooth_2.23-15 stringi_1.1.1     
## [34] lazyeval_0.2.0     munsell_0.4.3</code></pre>
<div align="right">
<em><a href="https://github.com/zhezhangsh/RoCA">Go to project home</a></em>
</div>
<hr />
<p><em>END OF DOCUMENT</em></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
